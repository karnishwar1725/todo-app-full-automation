---
- name: Verify local deployment after publish
  hosts: localhost
  gather_facts: no

  tasks:
    - name: Display deployment info
      debug:
        msg: "Checking status of deployed app: todo-app-karnishwar1725"

    - name: Confirm Node.js is installed
      command: node -v
      register: node_version
      ignore_errors: yes

    - name: Show Node.js version (if available)
      debug:
        var: node_version.stdout

    - name: Test website response (expect 200 OK)
      uri:
        url: "https://todo-app-karnishwar1725.azurewebsites.net/"
        method: GET
        status_code: 200
        return_content: no
        validate_certs: no
      register: response
      retries: 5
      delay: 5
      until: response.status == 200

    - name: Print final site status
      debug:
        msg: "âœ… Site is live and responded with status {{ response.status }}"
